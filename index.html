<!DOCTYPE html>
<html lang="ja" dir="ltr">
  <head>
    <meta charset="utf-8">
    <!-- //
      lkz138/kintai_01 is licensed under the MIT License
      A short and simple permissive license with conditions only requiring preservation of copyright and license notices.
      Licensed works, modifications, and larger works may be distributed under different terms and without source code.

      Permissions
        - Commercial use
        - Modification
        - Distribution
        - Private use
      Limitations
        - Liability
        - Warranty
      Conditions
        * License and copyright notice *

        MIT License

        Copyright (c) 2020 Yuu F N Takanashi

        Permission is hereby granted, free of charge, to any person obtaining a copy
        of this software and associated documentation files (the "Software"), to deal
        in the Software without restriction, including without limitation the rights
        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
        copies of the Software, and to permit persons to whom the Software is
        furnished to do so, subject to the following conditions:

        The above copyright notice and this permission notice shall be included in all
        copies or substantial portions of the Software.

        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
        SOFTWARE.
    // -->
    <title>勤怠管理 送信</title>
    <script type="text/javascript" src="./lib/jQuery.js"></script>
    <link rel="stylesheet" media="screen" href="./lib/font.css">
    <script type="text/javascript" charset="utf-8" src="./lib/setup_icon.js"></script>
    <link rel="stylesheet" media="screen" href="./lib/layout.menu.css">
    <script type="text/javascript" charset="utf-8" src="./lib/toolbox.menu.js"></script>
    <link rel="stylesheet" media="screen" href="./lib/layout.timetable.css">
    <script type="text/javascript" charset="utf-8" src="./lib/getTimer.js"></script>
    <script type="text/javascript" charset="utf-8" src="./lib/isJSON.js"></script>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="manifest" href="./lib/manifest.json">
    <script type="text/javascript">
      // Service Worker 登録
      localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ServiceWorker', JSON.stringify({token: ''}) );
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./lib/ServiceWorker.js').then(function(registration) {
          localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ServiceWorker', JSON.stringify({token: registration.scope}) );
        }).catch(function(err) {
          console.error('ServiceWorker registration failed. ');
          console.error(err);
        });
      } else {
        if (location.protocol != 'https:') {
          console.error('ServiceWorker registration failed. Not supported on http.');
        } else {
          console.error('ServiceWorker registration failed. Not supported on this browser.');
        }
      }
    </script>

    <script type="text/javascript" src="https://www.google.com/recaptcha/api.js?render=6LfCHdcUAAAAAOwkHsW_7W7MfoOrvoIw9CXdLRBA"></script>
    <script type="text/javascript">
      /*
       * Admin console url is 'https://www.google.com/recaptcha/admin'
       * Site key is '6LfCHdcUAAAAAOwkHsW_7W7MfoOrvoIw9CXdLRBA' (Use in 2 place)
       */
      grecaptcha.ready(function() {
        grecaptcha.execute('6LfCHdcUAAAAAOwkHsW_7W7MfoOrvoIw9CXdLRBA', {action: 'homepage'}).then(function(token) {
          localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.reCAPTCHA', JSON.stringify({token: token}) );
        });
      });
    </script>

    <script src="./lib/changeMonth.js" charset="utf-8"></script>
    <script type="text/javascript">
      $(function(){
        var targetMonth = JSON.parse(localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.targetMonth' ));
        if (!targetMonth) {
          targetMonth = {
            year: getTimer()['year'],
            month: getTimer()['month'],
          }
          localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.targetMonth', JSON.stringify(targetMonth) );
        }

        $('#timetable h1').text( Number(targetMonth['month']) + '月' + ' ' + Number(targetMonth['year']) );

        $('#timetable').append('<datalist />');
        $('#timetable datalist:last-child').attr({
          id: 'candidate_workshift_reasonText',
        });
        $.map([
          'シフト休',
          '明け休',
          '有給休暇',
          '振休',
        ], function(elms, index){
          $('#timetable datalist:last-child').append('<option />');
          $('#timetable datalist:last-child option:last-child').text(elms);
        });

        // 本体生成
        $('#kintai_timetable').append('<tbody />');

        // 日付ごとに子供生成
        for (var tbody_date = 1; tbody_date <= new Date(Number(targetMonth['year']), Number(targetMonth['month']), 0).getDate(); tbody_date++) {
          tbody_date_str = ('0' + tbody_date).slice(-2);

          // ja-JP 表記で曜日を取得
          tbody_date_str_day = ['日', '月', '火', '水', '木', '金', '土'][
            new Date(
              Number(targetMonth['year']),
              Number(targetMonth['month']) - 1,
              Number(tbody_date_str)
            ).getDay()
          ];
          var prev_day = new Date(
            Number(targetMonth['year']),
            Number(targetMonth['month']) - 1,
            Number(tbody_date_str) - 1
          );

          // 孫生成
          $('#kintai_timetable').children('tbody').append('<tr />');

          // その日の日付オブジェクト
          var targetDate = new Date(
            Number(targetMonth['year']),
            Number(targetMonth['month']) - 1,
            Number(tbody_date_str)
          );

          if(false){}
          else if( targetDate.toDateString() == (new Date()).toDateString() ){ /* 今日 */
            $('#kintai_timetable tbody tr:last-child').addClass('day_today');
          }
          else if( targetDate.getDay() == 0 ){ /* 日曜日 */
            $('#kintai_timetable tbody tr:last-child').addClass('day_sunday');
          }
          else if( targetDate.getDay() == 6 ){ /* 土曜日 */
            $('#kintai_timetable tbody tr:last-child').addClass('day_saturday');
          }

          // ひ孫生成
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').text(Number(targetMonth['month']) + '/' + tbody_date_str + '('+tbody_date_str_day+')');
          $('#kintai_timetable tbody tr:last-child td:last-child').append('<input />');
          $('#kintai_timetable tbody tr:last-child td:last-child input').attr({type: 'hidden'});
          $('#kintai_timetable tbody tr:last-child td:last-child input').val( targetMonth['year'] + targetMonth['month'] + tbody_date_str );

          // 始業時間
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<input />:<input /><input />');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(0).attr({
            type: 'tel', maxlength: 2,
            name: 'shigyo_h_' + tbody_date_str,
          }).addClass('timer_io timer_hour');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(1).attr({
            type: 'tel', maxlength: 2,
            name: 'shigyo_m_' + tbody_date_str,
          }).addClass('timer_io timer_min');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(2).attr({
            type: 'hidden',
            name: 'shigyo_' + tbody_date_str,
          });

          // 終業時間
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<input />:<input /><input />');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(0).attr({
            type: 'tel', maxlength: 2,
            name: 'syugyo_h_' + tbody_date_str,
          }).addClass('timer_io timer_hour');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(1).attr({
            type: 'tel', maxlength: 2,
            name: 'syugyo_m_' + tbody_date_str,
          }).addClass('timer_io timer_min');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(2).attr({
            type: 'hidden',
            name: 'syugyo_' + tbody_date_str,
          });

          // 休憩時間1
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<input />:<input /><input />');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(0).attr({
            type: 'tel', maxlength: 2,
            name: 'kyukei_1_h_' + tbody_date_str,
          }).addClass('timer_io timer_hour timer_refresh');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(1).attr({
            type: 'tel', maxlength: 2,
            name: 'kyukei_1_m_' + tbody_date_str,
          }).addClass('timer_io timer_min timer_refresh');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(2).attr({
            type: 'hidden',
            name: 'kyukei_1_' + tbody_date_str,
          });

          // 休憩時間2
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<input />:<input /><input />');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(0).attr({
            type: 'tel', maxlength: 2,
            name: 'kyukei_2_h_' + tbody_date_str,
          }).addClass('timer_io timer_hour timer_refresh');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(1).attr({
            type: 'tel', maxlength: 2,
            name: 'kyukei_2_m_' + tbody_date_str,
          }).addClass('timer_io timer_min timer_refresh');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(2).attr({
            type: 'hidden',
            name: 'kyukei_2_' + tbody_date_str,
          });

          // 小計勤務時間
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<output />');
          $('#kintai_timetable tbody tr:last-child td:last-child output').eq(0).attr({
            name: 'total_' + tbody_date_str,
          }).addClass('timer_io timer_total').text('00:00');

          // シフト時間
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<input /><img /><img />');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(0).attr({
            type: 'text',
            list: 'candidate_workshift_reasonText',
            readonly: true,
            name: 'workshift_' + tbody_date_str,
          }).addClass('timer_workshift');
          $('#kintai_timetable tbody tr:last-child td:last-child img').eq(0).attr({
            alt: '入力', src: './lib/icon/icon_edit.png',
            name: 'shifttime_input_' + tbody_date_str,
          }).addClass('dataicon rotationicon shifttime_input');
          $('#kintai_timetable tbody tr:last-child td:last-child img').eq(1).attr({
            alt: '複製', src: './lib/icon/icon_copy.png',
            name: 'shifttime_copy_' + tbody_date_str,
          }).addClass('dataicon rotationicon shifttime_copy');

          // 残業時間
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<output />');
          $('#kintai_timetable tbody tr:last-child td:last-child output').eq(0).attr({
            name: 'outOfTime_' + tbody_date_str,
          }).addClass('timer_io timer_over').text('00:00');

          // 深夜時間
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<output />');
          $('#kintai_timetable tbody tr:last-child td:last-child output').eq(0).attr({
            name: 'nightOfTime_' + tbody_date_str,
          }).addClass('timer_io timer_night').text('00:00');

          // 備考
          $('#kintai_timetable tbody tr:last-child').append('<td />');
          $('#kintai_timetable tbody tr:last-child td:last-child').html('<input />');
          $('#kintai_timetable tbody tr:last-child td:last-child input').eq(0).attr({
            type: 'text', maxlength: 64,
            name: 'bikou_' + tbody_date_str,
          }).addClass('bikou string_misc_io');

          // 入力データ消去
          $('#kintai_timetable tbody tr:last-child td:last-child').append('<img />');
          $('#kintai_timetable tbody tr:last-child td:last-child img').eq(0).attr({
            alt: '', src: './lib/icon/icon_cross.png',
            name: 'datareset_' + tbody_date_str,
          }).addClass('dataicon rotationicon datareset');
        }// 孫生成for{}

      });
    </script>
    <script src="./lib/checkHoliday.js" charset="utf-8"></script>
    <script src="./lib/linkev_conf_reset.js" charset="utf-8"></script>
    <script src="./lib/linkev_conf_setup.js" charset="utf-8"></script>
    <script src="./lib/linkev_data_export.js" charset="utf-8"></script>
    <script src="./lib/linkev_data_import.js" charset="utf-8"></script>
    <script src="./lib/linkev_data_load.js" charset="utf-8"></script>
    <script src="./lib/linkev_data_save.js" charset="utf-8"></script>
    <script src="./lib/linkev_data_statistics.js" charset="utf-8"></script>
    <script src="./lib/linkev_data_submit.js" charset="utf-8"></script>
    <script src="./lib/linkev_page_reload.js" charset="utf-8"></script>
    <script src="./lib/modalBoxWindow.js" charset="utf-8"></script>
    <script type="text/javascript">
      $(function(){
        $('input.timer_io').focus(function(){
          $(this).select();
        });

        $('input.timer_io').blur(function(){
          $(this).change();
        });

        $('input.timer_io').change(function(){
          /* 全角数字を半角数字に変える */
          $(this).val( ($(this).val()).replace(/[０-９]/g, function(s) {
            return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
          }) );

          /* 数字以外を削除 */
          $(this).val( ($(this).val()).replace(/[^0-9]/g, '') );

          /* 数字 1桁 を 2桁 にする */
          $(this).val( ( '00' + $(this).val() ).slice(-2) );

        });

        $('input.timer_io:not(input[name^=workshift_])').change(function(){
          var sectionId = $(this).attr('name').slice(-2);
          $('input[name=shigyo_'+sectionId+']').val(
              Number( $('input[name=shigyo_h_' + sectionId + ']').val()   * 60 )
            + Number( $('input[name=shigyo_m_' + sectionId + ']').val()        )
          );
          if ($('input[name=shigyo_h_' + sectionId + ']').val() == '') {
            $('input[name=shigyo_m_' + sectionId + ']').val('');
          }

          $('input[name=syugyo_'+sectionId+']').val(
              Number( $('input[name=syugyo_h_' + sectionId + ']').val()   * 60 )
            + Number( $('input[name=syugyo_m_' + sectionId + ']').val()        )
          );
          if ($('input[name=syugyo_h_' + sectionId + ']').val() == '') {
            $('input[name=syugyo_m_' + sectionId + ']').val('');
          }

          $('input[name=kyukei_1_'+sectionId+']').val(
              Number( $('input[name=kyukei_1_h_' + sectionId + ']').val() * 60 )
            + Number( $('input[name=kyukei_1_m_' + sectionId + ']').val()      )
          );
          if ($('input[name=kyukei_1_h_' + sectionId + ']').val() == '') {
            $('input[name=kyukei_1_m_' + sectionId + ']').val('');
          }

          $('input[name=kyukei_2_'+sectionId+']').val(
              Number( $('input[name=kyukei_2_h_' + sectionId + ']').val() * 60 )
            + Number( $('input[name=kyukei_2_m_' + sectionId + ']').val()      )
          );
          if ($('input[name=kyukei_2_h_' + sectionId + ']').val() == '') {
            $('input[name=kyukei_2_m_' + sectionId + ']').val('');
          }

          // 数値チェック
          var shigyo_time  = Number( $('input[name=shigyo_'    + sectionId + ']').val() );
          var syugyo_time  = Number( $('input[name=syugyo_'    + sectionId + ']').val() );
          var kyukei_1     = Number( $('input[name=kyukei_1_'  + sectionId + ']').val() );
          var kyukei_2     = Number( $('input[name=kyukei_2_'  + sectionId + ']').val() );
          var shift_time   = ( $('input[name=workshift_' + sectionId + ']').val() );
          var time_working = 0;
          var time_onshift = 0;
          var time_ovrtime = 0;
          var time_mdnight = 0;

          // エラー解除
          $('#kintai_timetable tbody tr:nth-child('+sectionId+') input.timer_io').removeClass('err_validation');

          // 終業時間が 始業時間と同じもしくはそれ以下 の場合 -> エラー表示
          if ( Number(syugyo_time) <= Number(shigyo_time) ){
            $('#kintai_timetable tbody tr:nth-child('+sectionId+') input.timer_io').addClass('err_validation');
          }

          // 終業時間と始業時間が　文字なし の場合 -> エラー表示解除
          if ( ( syugyo_time == '' ) && ( shigyo_time == '' ) ) {
            $('#kintai_timetable tbody tr:nth-child('+sectionId+') input.timer_io').removeClass('err_validation');
            $('input[name=kyukei_1_h_' + sectionId + ']').val('');
            $('input[name=kyukei_1_m_' + sectionId + ']').val('');
            $('input[name=kyukei_2_h_' + sectionId + ']').val('');
            $('input[name=kyukei_2_m_' + sectionId + ']').val('');
          }

          console.log( sectionId
            + '   ' + ''
            + '   ' + shigyo_time
            + '   ' + syugyo_time
            + '   ' + kyukei_1
            + '   ' + kyukei_2
            + '   ' + shift_time
            + '   ' + '|'
            + '   ' + $('input[name=shigyo_'    + sectionId + ']').val()
            + '   ' + $('input[name=syugyo_'    + sectionId + ']').val()
            + '   ' + $('input[name=kyukei_1_'  + sectionId + ']').val()
            + '   ' + $('input[name=kyukei_2_'  + sectionId + ']').val()
            + '   ' + $('input[name=workshift_' + sectionId + ']').val()
          );

          time_working = ( /* 勤務時間 */
            ( syugyo_time - shigyo_time ) - ( kyukei_1 + kyukei_2 )
          );

          // 勤務時間
          $('output[name=total_' + sectionId + ']').val(''
            + ( '00' + parseInt( time_working / 60 ) ).slice(-2)
            + ':'
            + ( '00' + parseInt( time_working % 60 ) ).slice(-2)
          );

          // 残業時間
          $('output[name=outOfTime_' + sectionId + ']').val('00:00');
          if( Number.isInteger( Number( shift_time ) ) ){
            if (shift_time.length == 8) {
              time_onshift = [
                ( shift_time ).slice(0, 4),
                ( shift_time ).slice(4, 8),
              ];
              time_onshift = [
                ( time_onshift[0] ).slice(0, 2),
                ( time_onshift[0] ).slice(2, 4),
                ( time_onshift[1] ).slice(0, 2),
                ( time_onshift[1] ).slice(2, 4),
              ];
              time_onshift = [
                ( Number( time_onshift[0] ) * 60 ),
                ( Number( time_onshift[1] )      ),
                ( Number( time_onshift[2] ) * 60 ),
                ( Number( time_onshift[3] )      ),
              ];
              time_onshift = [
                ( Number( time_onshift[0] ) + Number( time_onshift[1] ) ),
                ( Number( time_onshift[2] ) + Number( time_onshift[3] ) ),
              ];
              time_onshift = time_onshift[1] - time_onshift[0];
              if( (time_onshift / 60) > 6 ){ time_onshift -= 60; }

              console.log( '実働: ' + time_working + ' // ' + time_working / 60 );
              console.log( 'シフト: '+time_onshift + ' // ' + time_onshift / 60 );

            }

            time_ovrtime = time_working - time_onshift;
            if (time_ovrtime > 0) {
              $('output[name=outOfTime_' + sectionId + ']').val(''
                + ( '00' + parseInt( time_ovrtime / 60 ) ).slice(-2)
                + ':'
                + ( '00' + time_ovrtime % 60 ).slice(-2)
              );
            }
          }

          // 深夜時間
          console.log( shigyo_time + '..<..' + ( 60*05 ) + ': ' + ( shigyo_time < ( 60*05 ) ) + ' => ' + ( ( ( 60*05 ) - shigyo_time ) ) );
          console.log( syugyo_time + '..>..' + ( 60*22 ) + ': ' + ( syugyo_time > ( 60*22 ) ) + ' => ' + ( ( syugyo_time - ( 60*22 ) ) ) );

          if ( shigyo_time < ( 60*05 ) ) {
            if ( syugyo_time < ( 60*05 ) ) { time_mdnight += ( syugyo_time - shigyo_time ); }
            else { time_mdnight += ( ( 60*05 ) - shigyo_time ); }
          }

          if ( syugyo_time > ( 60*22 ) ) {
            if ( shigyo_time > ( 60*22 ) ) { time_mdnight += ( syugyo_time - shigyo_time ); }
            else { time_mdnight += ( syugyo_time - ( 60*22 ) ); }
          }

          $('output[name=nightOfTime_' + sectionId + ']').val(''
            + ( '00' + parseInt( time_mdnight / 60 ) ).slice(-2)
            + ':'
            + ( '00' + time_mdnight % 60 ).slice(-2)
          );

        });

        $('input.timer_hour').change(function(){
          if ($(this).val() >= 48) { $(this).val(0); }/* Out of range */
        });

        $('input.timer_min').change(function(){
          /*
           * quote: https://qiita.com/shuuuuun/items/f0031d710ca50b21177a
           * 配列から最も近い値(近似値)を探す
           */

          var value = $(this).val();
          if (value != '') {
            const minslist = [0, 15, 30, 45];
            var diff = [];
            var index = 0;

            $(minslist).each(function(i,val){
              diff[i] = Math.abs(value - val);
              index = (diff[index] < diff[i]) ? index : i;
            });

            $(this).val( ( '00' + minslist[index] ).slice(-2) );
          }
        });

        $('input.timer_hour:not(.timer_refresh)').focus(function(){
          /* blank のときは今の時間を代入 */
          if ($(this).val()=='') { $(this).val(getTimer()['hour']); }
          $(this).change();
        });

        $('input').change(function(){
          $(this).val( ( '' + $(this).val() ).trim() );
        });

        $('img.rotationicon').click(function(){
          var dataobject = $(this);
          $({deg:0}).animate({deg:360}, {
            duration: 1000,
            easing: 'swing',

            // 途中経過
            progress:function() {
              dataobject.css({
                transform:'rotate(' + this.deg + 'deg)'
              });
            },

            // アニメーション完了
            complete:function() {}
          });
        });

        $('img.shifttime_copy').click(function(){
          var dataobject = $(this);

          var sectionId = ('00'+dataobject.attr('name')).slice(-2);

          $('input[name=shigyo_h_'   + sectionId + ']').val( $('input[name="workshift_shigyo_h"]').val() );
          $('input[name=shigyo_m_'   + sectionId + ']').val( $('input[name="workshift_shigyo_m"]').val() );
          $('input[name=syugyo_h_'   + sectionId + ']').val( $('input[name="workshift_syugyo_h"]').val() );
          $('input[name=syugyo_m_'   + sectionId + ']').val( $('input[name="workshift_syugyo_m"]').val() );
          $('input[name=kyukei_1_h_' + sectionId + ']').val( $('input[name="workshift_kyukei_1_h"]').val() );
          $('input[name=kyukei_1_m_' + sectionId + ']').val( $('input[name="workshift_kyukei_1_m"]').val() );
          $('input[name=kyukei_2_h_' + sectionId + ']').val( $('input[name="workshift_kyukei_2_h"]').val() );
          $('input[name=kyukei_2_m_' + sectionId + ']').val( $('input[name="workshift_kyukei_2_m"]').val() );
          $('input[name=workshift_'  + sectionId + ']').val(
            (
                $('input[name="workshift_shigyo_h"]').val()
              + $('input[name="workshift_shigyo_m"]').val()
              + $('input[name="workshift_syugyo_h"]').val()
              + $('input[name="workshift_syugyo_m"]').val()
            ).replace(/:/g, '')
          );

          $('#kintai_timetable tbody tr:nth-child('+sectionId+') input.timer_io').change();
        });

        $('img.shifttime_input').click(function(){
          var dataobject = $(this);
          var sectionId = ('00'+dataobject.attr('name')).slice(-2);

          $('input[name=workshift_' + sectionId + ']').val( ( '' + $('input[name=workshift_' + sectionId + ']').val() ).trim() );

          if (!$('input[name=workshift_' + sectionId + ']').attr('readonly')) {
            $('input[name=workshift_' + sectionId + ']').attr('readonly', true);
          } else {
            $('input[name=workshift_' + sectionId + ']').attr('readonly', false);
          }
        });

        $('img.datareset').click(function(){
          var dataobject = $(this);
          var sectionId = ('00'+dataobject.attr('name')).slice(-2);

          console.log($('#kintai_timetable tbody tr:nth-child('+sectionId+') input:not([type=button])'));

          $('#kintai_timetable tbody tr:nth-child('+sectionId+') input').val('');
          $('#kintai_timetable tbody tr:nth-child('+sectionId+') input').map(function(index_dom, dom){
            dom.className = (dom.className).replace(/err_.*/, '');
          });
          $('#kintai_timetable tbody tr:nth-child('+sectionId+') output').val('00:00');
        });

      });
    </script>
    <script type="text/javascript">
      $(function(){
        // 備考 タブ幅 size 調整
        $('input[name="Bikou_tab_size"]').on('input', function(){
          $(this).next().text( (parseInt(this.value)) );
          $('#kintai_timetable tr input.bikou').css({
            width: parseInt(this.value),
          });
          localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ini_Bikou_tab_size', parseInt(this.value) );
        });

        // メニューアイコンサイズ 調整
        $('input[name="Menu_icon_size"]').on('input', function(){
          $(this).next().text( (parseInt(this.value)) );
          $('#menu_opener img').css({
            height: parseInt(this.value),
            width: parseInt(this.value),
          });
          localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ini_Menu_icon_size', parseInt(this.value) );
        });

        // Google recaptcha 可視性 調整
        $('input[name="Google_recaptcha_visibility"]').on('input', function(){
          $(this).next().text( (parseFloat(this.value)).toFixed(1) );
          $('.grecaptcha-badge').css('opacity', parseFloat(this.value));
          localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ini_Google_recaptcha_visibility', parseFloat(this.value) );
        });
      });
    </script>
    <script type="text/javascript">
      $(window).on('load', function(){
        // 備考 タブ幅 size 調整
        if(null === localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.ini_Bikou_tab_size' )){
          /* default */ localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ini_Bikou_tab_size', 150);
        }
        $('#kintai_timetable tr input.bikou').css({
          width: localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.ini_Bikou_tab_size' ),
        });

        // メニューアイコンサイズ 調整
        if(null === localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.ini_Menu_icon_size' )){
          /* default */ localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ini_Menu_icon_size', 32);
        }
        $('#menu_opener img').css({
          height: localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.ini_Menu_icon_size' ),
          width: localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.ini_Menu_icon_size' ),
        });

        // Google recaptcha 可視性 調整
        if(null === localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.ini_Google_recaptcha_visibility' )){
          /* default */ localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.ini_Google_recaptcha_visibility', 1.0);
        }
        $('.grecaptcha-badge').css('opacity', localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.ini_Google_recaptcha_visibility' ) );



        $('a[href="#data_load"]').click();
      });
    </script>
  </head>
  <body>
    <div class="sidemenu" id="menu_opener">
      <a tabindex="-1"><img alt="" src="./lib/icon/icon_menu.png" /></a>
    </div>
    <div class="sidemenu" id="menu_bar">
      <ul>
        <li><a tabindex="-1" href="#page_reload"><img class="accesslink" alt="" src="./lib/icon/icon_reload.png" />更新</a></li>
        <li><a tabindex="-1" href="#conf_setup"><img class="accesslink" alt="" src="./lib/icon/icon_setup.png" />設定</a></li>
        <li><a tabindex="-1" href="#data_save"><img class="accesslink" alt="" src="./lib/icon/icon_save.png" />保存</a></li>
        <li><a tabindex="-1" href="#data_load"><img class="accesslink" alt="" src="./lib/icon/icon_load.png" />開く</a></li>
        <li><a tabindex="-1" href="#data_submit"><img class="accesslink" alt="" src="./lib/icon/icon_submit.png" />提出</a></li>
        <li><a tabindex="-1" href="#data_statistics"><img class="accesslink" alt="" src="./lib/icon/icon_statistics.png" />統計</a></li>
        <li><a tabindex="-1" href="https://github.com/lkz138/kintai_01/"><img class="accesslink" alt="" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" />Src</a></li>
      </ul>
    </div>
    <div class="sidemenu modalBoxWindow" id="kintai_timetable_dataImport">
      <div class="modalBoxWindow_close"></div>
      <div class="modalBoxWindow_contents">
        <p>テキスト形式とファイル形式両方選択した場合ファイル形式が優先されます</p>
        <textarea name="kintai_timetable_dataImport_object"></textarea>
        <input disabled name="kintai_timetable_dataImport_object" type="file" /><br />
        <a href="#kintai_timetable_dataImport_run">取り込み実行</a>
      </div>
    </div>
    <div class="sidemenu modalBoxWindow" id="kintai_timetable_statistics">
      <div class="modalBoxWindow_close"></div>
      <div class="modalBoxWindow_contents">
<table>
  <thead>
    <tr>
      <th></th>
      <td></td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>総出勤日数</th>
      <td>0</td>
    </tr>
    <tr>
      <th>総勤務時間</th>
      <td>0</td>
    </tr>
    <tr>
      <th>総残業時間</th>
      <td>0</td>
    </tr>
    <tr>
      <th>総深夜時間</th>
      <td>0</td>
    </tr>
    <tr>
      <th></th>
      <td></td>
    </tr>
    <tr>
      <th>総出勤日数</th>
      <td></td>
    </tr>
    <tr>
      <th>総勤務時間</th>
      <td></td>
    </tr>
    <tr>
      <th>総残業時間</th>
      <td></td>
    </tr>
    <tr>
      <th>総深夜時間</th>
      <td></td>
    </tr>
    <tr>
      <th></th>
      <td></td>
    </tr>
    <tr>
      <th>総出勤日数</th>
      <td></td>
    </tr>
    <tr>
      <th>総勤務時間</th>
      <td></td>
    </tr>
    <tr>
      <th>総残業時間</th>
      <td></td>
    </tr>
    <tr>
      <th>総深夜時間</th>
      <td></td>
    </tr>
  </tbody>
</table>
      </div>
    </div>
    <div class="sidemenu modalBoxWindow" id="menu_config_bar">
      <div class="modalBoxWindow_close"></div>
      <div class="modalBoxWindow_contents">
        <ul>
          <li><a tabindex="-1" href="#conf_reset">設定とデータをリセット</a></li>
          <li><a tabindex="-1" href="#data_export"><img class="accesslink" alt="" src="./lib/icon/icon_export.png" />テキストとして保存</a></li>
          <li><a tabindex="-1" href="#data_import"><img class="accesslink" alt="" src="./lib/icon/icon_import.png" />テキストから取込み</a></li>
        </ul>
        <table>
          <tbody>
            <tr>
              <td>備考 タブ幅 size</td>
              <td><input type="range" max="300" min="15" step="5" value="150" name="Bikou_tab_size" /><output></output></td>
            </tr>
            <tr>
              <td>Menu icon size</td>
              <td><input type="range" max="70" min="15" step="1" value="32" name="Menu_icon_size" /><output></output></td>
            </tr>
            <tr>
              <td>Google recaptcha visibility</td>
              <td><input type="range" max="1" min="0" step="0.1" value="1" name="Google_recaptcha_visibility" /><output></output></td>
            </tr>
            <tr>
              <td>Google mail setup</td>
              <td><a tabindex="-1" href="#auth_login">&lt;comming soon&gt;ログイン</a></td>
            </tr>
            <tr>
              <td>Account Name</td>
              <td>anonymous</td>
            </tr>
            <tr>
              <td>Mail From</td>
              <td>anonymous</td>
            </tr>
            <tr>
              <td>Mail To</td>
              <td><input type="email" name="Google_mail_sendTo" value="" /></td>
            </tr>
            <tr>
              <td>Mail CC</td>
              <td><input type="email" name="Google_mail_sendCc" value="" /></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="timetable">
      <h1></h1>
      <h2>&lt; <a class="month_prev">前月</a> <a class="month_this">今月</a> <a class="month_next">翌月</a> &gt;</h2>
      <table id="kintai_timetable">
        <thead>
          <tr>
            <th>日付</th>
            <th>始業</th>
            <th>終業</th>
            <th>休憩(通常)</th>
            <th>休憩(夜間)</th>
            <th>勤務</th>
            <th>シフト</th>
            <th>残業</th>
            <th>深夜</th>
            <th>備考</th>
          </tr>
          <tr>
            <td>シフト</td>
            <td><input class="timer_io timer_hour" type="tel" maxlength="2" value="09" name="workshift_shigyo_h">:<input class="timer_io timer_min" type="tel" maxlength="2" value="00" name="workshift_shigyo_m"></td>
            <td><input class="timer_io timer_hour" type="tel" maxlength="2" value="18" name="workshift_syugyo_h">:<input class="timer_io timer_min" type="tel" maxlength="2" value="00" name="workshift_syugyo_m"></td>
            <td><input class="timer_io timer_hour" type="tel" maxlength="2" value="01" name="workshift_kyukei_1_h">:<input class="timer_io timer_min" type="tel" maxlength="2" value="00" name="workshift_kyukei_1_m"></td>
            <td><input class="timer_io timer_hour" type="tel" maxlength="2" value="00" name="workshift_kyukei_2_h">:<input class="timer_io timer_min" type="tel" maxlength="2" value="00" name="workshift_kyukei_2_m"></td>
            <td></td>
            <td><select class="" name="workshift_worktype">
              <option value="fixed">固定</option>
              <option value="shift">変形</option>
            </select></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </thead>
      </table>
    </div>
    <p>Chrome, Firefox, Safari or Edge are recommended. Copyright &copy; 2020 n138.nws. All Rights Reserved.</p>
  </body>
</html>
